import{q as ue}from"./index-BJbpV1ez.js";import{C as P,_ as B,a as Q,d as X,f as Y,h as ee,i as me,D as F,u as te,p as fe,W as _e,S as M,P as ve,l as he,m as we,n as ye,o as ge}from"./CopyrightSection-9O_4UxBk.js";import{L as W,c as be,q as ke,a as Se}from"./clickOutside-ChSsTmv7.js";import{d as R,j as k,g as x,N as S,h as ae,c as I,a as t,k as s,u as w,w as g,n as z,q as y,b as J,o as u,aa as $e,I as Ce,J as De,D as Ie,F as N,r as A,e as V,l as G,p as T,f as U,P as se,W as O}from"./index-CVg4CX2G.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./image-BduBmCIG.js";import"./SoxCheckbox-KYOcrCkW.js";const Ve=a=>(T("data-v-3942d2b3"),a=a(),U(),a),Pe={class:"control-section"},Re={class:"main-controls"},Ee={class:"downloader-body"},Ke={class:"downloader-items"},xe=Ve(()=>t("div",{class:"downloader-hints"},[t("div",null,"建议 PC 端使用，移动端兼容性较差："),t("div",null,"· 如果头像未加载，重新生成几次即可")],-1)),Oe={class:"in-out-modal-body"},Ne={class:"in-out-modal-panel"},Ae={class:"in-out-modal-panel"},Te=R({__name:"ControlSection",props:{paperEls:{}},emits:["add-paper"],setup(a,{emit:c}){const d=a,v=c,$=te(),n=Q(),m=X(),l=Y(),h=k(""),f=x(()=>{const o=JSON.stringify({pc:n==null?void 0:n.value,viewData:{...m}});return W.compressToEncodedURIComponent(o)}),_=x(()=>{const o=new Blob([f.value],{type:"text/plain;charset=utf-8"});return URL.createObjectURL(o)}),b=k(!1),E=k(!1),K=k(!1);function oe(){v("add-paper")}function le(){!n||!m||(n.value=S(ee()),me(m),z(()=>{$.removeItem("autoSaved")}),y.info("已重置人物卡"),K.value=!1)}const C=S([]);async function ie(o){if(!d.paperEls.length)throw"Setup Error: `paperEls` not exists";const e=typeof o!="number";e&&C.splice(0,C.length);for(let r=0;r<d.paperEls.length;r++){const p=d.paperEls[r];if(!e&&r!==o)continue;const i=await fe(p);if(e)C.push(i);else{C[o]=i;break}await new Promise(D=>setTimeout(D,1e3))}}const q=x(()=>{const{name:o,playerName:e}=(n==null?void 0:n.value)||{},r="【TRPG赛高】",p=[o,e].filter(i=>i).join("-");return`${r}${p}${p?"-":""}`});function L(o){if(l){if(l.printing){y.info("已经在运行啦，请不要同时多次生成图片");return}l.printing=!0,y.info({message:"图片生成中，页面会有轻微抖动，请稍候…",duration:1e3,onClose(){ie(o).then(()=>{E.value=!0,l.printing=!1})}})}}function re(){b.value=!0}function ce(){be(f.value),y.success("已复制到剪贴板")}function de(){const o=W.decompressFromEncodedURIComponent(h.value),e=JSON.parse(o);if(l&&(l.importing=!0),e&&e.viewData&&e.pc&&m&&n)try{n.value=e.pc,Object.keys(e.viewData).forEach(r=>{const p=r;m[p]=e.viewData[p]}),y.success("已成功导入"),b.value=!1,K.value=!1}catch{y.error("数据有误，无法导入。页面可能因此受损，建议刷新")}else y.error("数据有误，无法导入");l&&(l.importing=!1)}const pe=ae(K,o=>{if(o){const e=new Image;e.src=ke,z(()=>{e.src=Se}),pe()}});return(o,e)=>{const r=J("el-input"),p=J("el-button");return u(),I("div",Pe,[t("div",Re,[s(P,{label:"增加一页",icon:w($e),onClick:oe},null,8,["icon"]),s(P,{label:"重置",icon:w(Ce),onClick:le},null,8,["icon"]),s(P,{label:"导入/导出数据",icon:w(De),onClick:re},null,8,["icon"]),s(P,{label:"保存",icon:w(Ie),onClick:e[0]||(e[0]=()=>L())},null,8,["icon"])]),s(B,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=i=>E.value=i),title:"下载图片/数据"},{default:g(()=>[t("div",Ee,[t("div",Ke,[(u(!0),I(N,null,A(C,(i,D)=>(u(),V(F,{key:D,title:`无限技能表${D+1}`,refreshable:"",previewImage:i,download:{url:i,name:q.value,type:"jpg"},onRefresh:()=>L(D)},null,8,["title","previewImage","download","onRefresh"]))),128)),s(F,{title:"无限技能表数据",download:{url:_.value,name:q.value,type:"txt"}},null,8,["download"])]),xe])]),_:1},8,["modelValue"]),s(B,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=i=>b.value=i),title:"导入/导出数据",onClosed:e[4]||(e[4]=i=>h.value="")},{default:g(()=>[t("div",Oe,[t("div",Ne,[s(r,{type:"textarea",value:f.value,rows:16,readonly:!0,resize:"none"},null,8,["value"]),s(p,{type:"primary",onClick:ce},{default:g(()=>[G(" 复制以上内容 ")]),_:1})]),t("div",Ae,[s(r,{type:"textarea",modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=i=>h.value=i),rows:16,placeholder:"将文本粘贴到这里",resize:"none"},null,8,["modelValue"]),s(p,{type:"primary",onClick:de},{default:g(()=>[G(" 导入以上内容 ")]),_:1})])])]),_:1},8,["modelValue"])])}}}),Ue=j(Te,[["__scopeId","data-v-3942d2b3"]]),ne=a=>(T("data-v-7614487f"),a=a(),U(),a),je={class:"header"},qe=ne(()=>t("h1",{class:"heading"},[t("span",{class:"title"},"无限技能表"),t("span",{class:"subtitle"},"Infinity Skills")],-1)),Le={class:"point-container"},Be={class:"skill-section-body"},Fe=ne(()=>t("div",{class:"divider"},null,-1)),Z=1,Me=R({__name:"SkillSection",props:{hiddenKey:{}},setup(a){const c=a,d=Q(),v=X(),$=Y();ae(()=>v,()=>{v&&(v.showingChildSkills[`_h${c.hiddenKey}l`]=[],v.showingChildSkills[`_h${c.hiddenKey}r`]=[])},{immediate:!0});const n=S([{groupName:"其它",groupSkills:[{init:0,intro:"自定义技能",name:"",hidden:`_h${c.hiddenKey}l`,group:{show:Array(51).fill(""),skills:[]}}]},{groupName:"其它",groupSkills:[{init:0,intro:"自定义技能",name:"",hidden:`_h${c.hiddenKey}r`,group:{show:Array(51).fill(""),skills:[]}}]}]);return(m,l)=>{var h;return u(),V(ve,{class:se(["skill-section",{"printing-image":(h=w($))==null?void 0:h.printing}])},{header:g(()=>{var f;return[t("div",je,[qe,t("div",Le,[s(_e,{class:"point-writer",label:"角色名",modelValue:`${((f=w(d))==null?void 0:f.name)??""}`,"onUpdate:modelValue":l[0]||(l[0]=_=>{w(d)&&(w(d).name=_)})},null,8,["modelValue"])])])]}),default:g(()=>[t("div",Be,[s(M,{data:n.slice(0,Z)},null,8,["data"]),Fe,s(M,{data:n.slice(Z)},null,8,["data"])])]),_:1},8,["class"])}}}),We=j(Me,[["__scopeId","data-v-7614487f"]]),H=R({__name:"PaperOne",props:{setRef:{},hiddenKey:{}},setup(a){return(c,d)=>(u(),V(we,{setRef:c.setRef},{default:g(()=>[s(We,{hiddenKey:c.hiddenKey},null,8,["hiddenKey"]),s(he)]),_:1},8,["setRef"]))}}),ze=a=>(T("data-v-0bcec903"),a=a(),U(),a),Je={class:"page theme-dark"},Ge=ze(()=>t("h1",{class:"title web-only"},"无限技能表（内部使用版）",-1)),Ze={class:"paper-container theme-light"},He={class:"papers-animation-container papers-editing web-only"},Qe={class:"sticky-footer web-only"},Xe=R({__name:"AppView",setup(a){const c=ue.parse(location.search.slice(1)),d=k(ee()),v=te(),$=S(ye(c)),n=S({paperInFront:!0,printing:!1,importing:!1,showTotalSeparation:v.getItem("showTotalSeparation")||!1});ge(d),O("pc",d),O("viewData",$),O("pageData",n);const m=S([]),l=k(1);return(h,f)=>(u(),I("main",Je,[Ge,t("div",Ze,[t("div",He,[(u(!0),I(N,null,A(l.value,_=>(u(),V(H,{key:_,hiddenKey:_},null,8,["hiddenKey"]))),128))]),t("div",{class:se(["papers-printing",{"papers-printing-active":n.printing}])},[(u(!0),I(N,null,A(l.value,_=>(u(),V(H,{setRef:b=>{m[0]=b},key:_,hiddenKey:_},null,8,["setRef","hiddenKey"]))),128))],2)]),t("div",Qe,[s(Ue,{paperEls:m,onAddPaper:f[0]||(f[0]=()=>l.value+=1)},null,8,["paperEls"])])]))}}),lt=j(Xe,[["__scopeId","data-v-0bcec903"]]);export{lt as default};
