import{q as ce}from"./index-Dq4ts1y5.js";import{C as P,_ as q,a as H,d as Q,f as X,h as Y,i as de,D as F,u as ee,p as pe,W as ue,S as M,P as me,l as fe,m as _e,n as ve,o as he}from"./CopyrightSection-DDeKC3J3.js";import{L as z,c as we}from"./clickOutside-CIwNuZnB.js";import{d as R,j as k,g as K,N as S,c as V,a as t,k as s,u as w,w as g,n as ye,q as y,b as J,o as u,aa as ge,I as be,J as ke,D as Se,F as O,r as N,e as I,l as W,p as T,f as U,h as $e,P as te,W as x}from"./index-CnXjCZEO.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./image-BduBmCIG.js";import"./SoxCheckbox-CFVVcII3.js";const Ce=a=>(T("data-v-cd3806b3"),a=a(),U(),a),De={class:"control-section"},Ve={class:"main-controls"},Ie={class:"downloader-body"},Pe={class:"downloader-items"},Re=Ce(()=>t("div",{class:"downloader-hints"},[t("div",null,"建议 PC 端使用，移动端兼容性较差："),t("div",null,"· 如果头像未加载，重新生成几次即可")],-1)),Ee={class:"in-out-modal-body"},Ke={class:"in-out-modal-panel"},xe={class:"in-out-modal-panel"},Oe=R({__name:"ControlSection",props:{paperEls:{}},emits:["add-paper"],setup(a,{emit:c}){const d=a,v=c,$=ee(),o=H(),m=Q(),n=X(),h=k(""),f=K(()=>{const l=JSON.stringify({pc:o==null?void 0:o.value,viewData:{...m}});return z.compressToEncodedURIComponent(l)}),_=K(()=>{const l=new Blob([f.value],{type:"text/plain;charset=utf-8"});return URL.createObjectURL(l)}),b=k(!1),E=k(!1),A=k(!1);function se(){v("add-paper")}function oe(){!o||!m||(o.value=S(Y()),de(m),ye(()=>{$.removeItem("autoSaved")}),y.info("已重置人物卡"),A.value=!1)}const C=S([]);async function ne(l){if(!d.paperEls.length)throw"Setup Error: `paperEls` not exists";const e=typeof l!="number";e&&C.splice(0,C.length);for(let r=0;r<d.paperEls.length;r++){const p=d.paperEls[r];if(!e&&r!==l)continue;const i=await pe(p);if(e)C.push(i);else{C[l]=i;break}await new Promise(D=>setTimeout(D,1e3))}}const L=K(()=>{const{name:l,playerName:e}=(o==null?void 0:o.value)||{},r="【TRPG赛高】",p=[l,e].filter(i=>i).join("-");return`${r}${p}${p?"-":""}`});function B(l){if(n){if(n.printing){y.info("已经在运行啦，请不要同时多次生成图片");return}n.printing=!0,y.info({message:"图片生成中，页面会有轻微抖动，请稍候…",duration:1e3,onClose(){ne(l).then(()=>{E.value=!0,n.printing=!1})}})}}function le(){b.value=!0}function ie(){we(f.value),y.success("已复制到剪贴板")}function re(){const l=z.decompressFromEncodedURIComponent(h.value),e=JSON.parse(l);if(n&&(n.importing=!0),e&&e.viewData&&e.pc&&m&&o)try{o.value=e.pc,Object.keys(e.viewData).forEach(r=>{const p=r;m[p]=e.viewData[p]}),y.success("已成功导入"),b.value=!1,A.value=!1}catch{y.error("数据有误，无法导入。页面可能因此受损，建议刷新")}else y.error("数据有误，无法导入");n&&(n.importing=!1)}return(l,e)=>{const r=J("el-input"),p=J("el-button");return u(),V("div",De,[t("div",Ve,[s(P,{label:"增加一页",icon:w(ge),onClick:se},null,8,["icon"]),s(P,{label:"重置",icon:w(be),onClick:oe},null,8,["icon"]),s(P,{label:"导入/导出数据",icon:w(ke),onClick:le},null,8,["icon"]),s(P,{label:"保存",icon:w(Se),onClick:e[0]||(e[0]=()=>B())},null,8,["icon"])]),s(q,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=i=>E.value=i),title:"下载图片/数据"},{default:g(()=>[t("div",Ie,[t("div",Pe,[(u(!0),V(O,null,N(C,(i,D)=>(u(),I(F,{key:D,title:`无限技能表${D+1}`,refreshable:"",previewImage:i,download:{url:i,name:L.value,type:"jpg"},onRefresh:()=>B(D)},null,8,["title","previewImage","download","onRefresh"]))),128)),s(F,{title:"无限技能表数据",download:{url:_.value,name:L.value,type:"txt"}},null,8,["download"])]),Re])]),_:1},8,["modelValue"]),s(q,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=i=>b.value=i),title:"导入/导出数据",onClosed:e[4]||(e[4]=i=>h.value="")},{default:g(()=>[t("div",Ee,[t("div",Ke,[s(r,{type:"textarea",value:f.value,rows:16,readonly:!0,resize:"none"},null,8,["value"]),s(p,{type:"primary",onClick:ie},{default:g(()=>[W(" 复制以上内容 ")]),_:1})]),t("div",xe,[s(r,{type:"textarea",modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=i=>h.value=i),rows:16,placeholder:"将文本粘贴到这里",resize:"none"},null,8,["modelValue"]),s(p,{type:"primary",onClick:re},{default:g(()=>[W(" 导入以上内容 ")]),_:1})])])]),_:1},8,["modelValue"])])}}}),Ne=j(Oe,[["__scopeId","data-v-cd3806b3"]]),ae=a=>(T("data-v-7614487f"),a=a(),U(),a),Te={class:"header"},Ue=ae(()=>t("h1",{class:"heading"},[t("span",{class:"title"},"无限技能表"),t("span",{class:"subtitle"},"Infinity Skills")],-1)),je={class:"point-container"},Ae={class:"skill-section-body"},Le=ae(()=>t("div",{class:"divider"},null,-1)),G=1,Be=R({__name:"SkillSection",props:{hiddenKey:{}},setup(a){const c=a,d=H(),v=Q(),$=X();$e(()=>v,()=>{v&&(v.showingChildSkills[`_h${c.hiddenKey}l`]=[],v.showingChildSkills[`_h${c.hiddenKey}r`]=[])},{immediate:!0});const o=S([{groupName:"其它",groupSkills:[{init:0,intro:"自定义技能",name:"",hidden:`_h${c.hiddenKey}l`,group:{show:Array(51).fill(""),skills:[]}}]},{groupName:"其它",groupSkills:[{init:0,intro:"自定义技能",name:"",hidden:`_h${c.hiddenKey}r`,group:{show:Array(51).fill(""),skills:[]}}]}]);return(m,n)=>{var h;return u(),I(me,{class:te(["skill-section",{"printing-image":(h=w($))==null?void 0:h.printing}])},{header:g(()=>{var f;return[t("div",Te,[Ue,t("div",je,[s(ue,{class:"point-writer",label:"角色名",modelValue:`${((f=w(d))==null?void 0:f.name)??""}`,"onUpdate:modelValue":n[0]||(n[0]=_=>{w(d)&&(w(d).name=_)})},null,8,["modelValue"])])])]}),default:g(()=>[t("div",Ae,[s(M,{data:o.slice(0,G)},null,8,["data"]),Le,s(M,{data:o.slice(G)},null,8,["data"])])]),_:1},8,["class"])}}}),qe=j(Be,[["__scopeId","data-v-7614487f"]]),Z=R({__name:"PaperOne",props:{setRef:{},hiddenKey:{}},setup(a){return(c,d)=>(u(),I(_e,{setRef:c.setRef},{default:g(()=>[s(qe,{hiddenKey:c.hiddenKey},null,8,["hiddenKey"]),s(fe)]),_:1},8,["setRef"]))}}),Fe=a=>(T("data-v-0bcec903"),a=a(),U(),a),Me={class:"page theme-dark"},ze=Fe(()=>t("h1",{class:"title web-only"},"无限技能表（内部使用版）",-1)),Je={class:"paper-container theme-light"},We={class:"papers-animation-container papers-editing web-only"},Ge={class:"sticky-footer web-only"},Ze=R({__name:"AppView",setup(a){const c=ce.parse(location.search.slice(1)),d=k(Y()),v=ee(),$=S(ve(c)),o=S({paperInFront:!0,printing:!1,importing:!1,showTotalSeparation:v.getItem("showTotalSeparation")||!1});he(d),x("pc",d),x("viewData",$),x("pageData",o);const m=S([]),n=k(1);return(h,f)=>(u(),V("main",Me,[ze,t("div",Je,[t("div",We,[(u(!0),V(O,null,N(n.value,_=>(u(),I(Z,{key:_,hiddenKey:_},null,8,["hiddenKey"]))),128))]),t("div",{class:te(["papers-printing",{"papers-printing-active":o.printing}])},[(u(!0),V(O,null,N(n.value,_=>(u(),I(Z,{setRef:b=>{m[0]=b},key:_,hiddenKey:_},null,8,["setRef","hiddenKey"]))),128))],2)]),t("div",Ge,[s(Ne,{paperEls:m,onAddPaper:f[0]||(f[0]=()=>n.value+=1)},null,8,["paperEls"])])]))}}),st=j(Ze,[["__scopeId","data-v-0bcec903"]]);export{st as default};
